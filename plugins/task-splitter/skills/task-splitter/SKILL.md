---
name: task-splitter
description: タスクを分析して並列実行可能なサブタスクに分割し、各サブタスクに関連ファイルを紐付けるスキル。/split-task コマンドで使用。大きなタスクをPhase分けして並列実行計画を作成する。
version: "1.0.0"
allowed-tools:
  - Read
  - Glob
  - Grep
  - Bash(find:*)
  - Bash(wc:*)
---

# task-splitter スキル

タスクを分析して並列実行可能なサブタスクに分割し、各サブタスクに関連ファイルを紐付ける。

## 入力

このスキルは以下の情報を受け取る:

1. **タスク詳細**: ユーザーが実行したいタスクの説明
2. **関連ファイル群**: project-onboarding プラグインなどから取得したファイル一覧（オプション）

## 処理フロー

### Step 1: タスク分析

タスク詳細を分析し、以下を抽出する:

- **機能単位**: 独立して実装可能な機能の塊
- **変更種別**: 新規作成 / 修正 / 削除 / テスト追加
- **技術領域**: フロントエンド / バックエンド / データベース / インフラ など

### Step 2: サブタスク分解

タスクを以下の基準で分解する:

**分解の原則**:
- **単一責任**: 各サブタスクは1つの明確な目的を持つ
- **独立性**: 可能な限り他のサブタスクに依存しない
- **検証可能**: 完了を確認できる基準がある
- **適切な粒度**: 1サブタスク = 1-3ファイルの変更が目安

**分解パターン**:

```
機能追加タスク:
├── 基盤実装（型定義、インターフェース）
├── コア実装（ビジネスロジック）
├── UI実装（コンポーネント）
├── 統合（既存コードとの接続）
└── テスト（単体テスト、結合テスト）

リファクタリングタスク:
├── 分析（現状把握、影響範囲）
├── 準備（テスト追加、型定義）
├── 変換（段階的な変更）
└── 検証（テスト実行、動作確認）

バグ修正タスク:
├── 調査（再現、原因特定）
├── 修正（最小限の変更）
├── テスト追加（再発防止）
└── 検証（修正確認）
```

### Step 3: 依存関係分析

サブタスク間の依存関係を以下の観点で分析:

**依存の種類**:
- **データ依存**: 前のタスクの出力が入力になる
- **構造依存**: 前のタスクで作成される型/インターフェースを使用
- **機能依存**: 前のタスクの機能を呼び出す

**並列実行の条件**:
- 依存関係がない
- 異なるファイル群を操作する
- 互いに影響しない領域を担当する

### Step 4: ファイル紐付け

各サブタスクに関連ファイルを紐付ける:

**紐付けロジック**:
1. **キーワードマッチング**: サブタスクの説明と関連ファイルのパス/内容を照合
2. **依存関係からの推論**: import/export関係から関連ファイルを特定
3. **新規ファイルの推定**: 命名規則から作成されるべきファイルパスを推定

**ファイル分類**:
- **新規**: 作成が必要なファイル（ファイルが存在しない場合）
- **修正**: 変更が必要な既存ファイル
- **参照**: 読み取りのみ（型定義、設定など）

### Step 5: フェーズ構成

依存関係に基づいてサブタスクをフェーズに整理:

```
Phase 1: 依存関係のない基盤タスク（並列実行可能）
    ↓
Phase 2: Phase 1に依存するタスク（並列実行可能）
    ↓
Phase 3: Phase 2に依存するタスク（並列実行可能）
    ...
```

### Step 6: 見積もりの付与

各サブタスクに相対的な見積もりを付与:

| 見積もり | 基準 |
|---------|------|
| 小 | 1ファイルの軽微な変更、明確な実装パターン |
| 中 | 2-3ファイルの変更、ある程度の判断が必要 |
| 大 | 4ファイル以上、設計判断が必要、複雑なロジック |

## 出力フォーマット

```markdown
# タスク分割結果

## 元タスク

{original_task_description}

## サブタスク一覧

### Phase 1（並列実行可能）

| ID | タスク | 関連ファイル | 見積もり |
|----|--------|-------------|---------|
| 1-1 | {task_description} | `{file_path}`(新規), `{file_path}` | 小/中/大 |
| 1-2 | {task_description} | `{file_path}` | 小/中/大 |

### Phase 2（Phase 1完了後）

| ID | タスク | 関連ファイル | 依存 |
|----|--------|-------------|------|
| 2-1 | {task_description} | `{file_path}` | 1-1 |
| 2-2 | {task_description} | `{file_path}` | 1-1, 1-2 |

### Phase 3（Phase 2完了後）

| ID | タスク | 関連ファイル | 依存 |
|----|--------|-------------|------|
| 3-1 | {task_description} | `{file_path}`(新規) | 2-1 |

## 依存関係図

```
Phase 1 (並列)          Phase 2 (並列)        Phase 3 (並列)
┌─────────────┐
│ 1-1 {name}  │──────┬──→ 2-1 {name} ──────→ 3-1 {name}
└─────────────┘      │
┌─────────────┐      └──→ 2-2 {name}
│ 1-2 {name}  │
└─────────────┘
```

## 実行計画

```bash
# Phase 1: {n}つのタスクを並列実行
Task(1-1), Task(1-2), ... → 並列

# Phase 2: Phase 1完了後、{n}つのタスクを並列実行
Task(2-1), Task(2-2), ... → 並列

# Phase 3: Phase 2完了後、{n}つのタスクを並列実行
Task(3-1), ... → 並列
```

## 注意事項

- {注意すべき点があれば記載}
- {ファイル間の依存関係で気をつける点}
- {テスト実行のタイミングなど}
```

## 粒度オプション

ユーザーが粒度を指定できる:

- **細かく分割** (`--fine`): 1サブタスク = 1ファイル程度
- **標準** (デフォルト): 1サブタスク = 1-3ファイル
- **大まかに分割** (`--coarse`): 1サブタスク = 機能単位

## project-onboarding との連携

このスキルは `project-onboarding` プラグインの出力を活用する:

```
1. /find-files でタスクに関連するファイルを検索
2. その結果を task-splitter に渡す
3. task-splitter がファイル群をサブタスクに紐付け
```

## 検索ツールの使用

関連ファイルが提供されていない場合、自身で検索を行う:

```bash
# キーワードからファイルを検索
find . -type f \( -name "*keyword*" \) -not -path '*/node_modules/*' 2>/dev/null

# 内容からファイルを検索
grep -rl "keyword" --include="*.ts" --include="*.tsx" . 2>/dev/null | head -20
```

## 制約

- 最大フェーズ数: 5
- 最大サブタスク数: 20
- 1サブタスク当たりの最大関連ファイル数: 5
