<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カスタムドキュメントHTML化機能の実装</title>
    <style>
:root {
    --bg-primary: #1e1e1e;
    --bg-secondary: #252526;
    --bg-tertiary: #2d2d30;
    --text-primary: #d4d4d4;
    --text-secondary: #9e9e9e;
    --accent: #569cd6;
    --accent-hover: #4a8bc2;
    --border: #3e3e42;
    --code-bg: #1e1e1e;
    --success: #4ec9b0;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
}

.toc {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    padding: 2rem 1rem;
}

.toc-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--accent);
}

.toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.toc-item {
    margin-bottom: 0.5rem;
}

.toc-link {
    display: block;
    padding: 0.5rem 0.75rem;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

.toc-link:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.toc-link.active {
    background: var(--accent);
    color: white;
}

.toc-item.level-2 {
    padding-left: 1rem;
}

.toc-item.level-3 {
    padding-left: 2rem;
}

.content {
    margin-left: 300px;
    padding: 2rem 3rem;
    max-width: 1200px;
}

h1 {
    font-size: 2.5rem;
    margin: 0 0 2rem 0;
    color: var(--text-primary);
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.5rem;
}

h2 {
    font-size: 1.8rem;
    margin: 3rem 0 1rem 0;
    color: var(--text-primary);
    position: relative;
    padding-left: 1rem;
}

h2::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 70%;
    background: var(--accent);
    border-radius: 2px;
}

h3 {
    font-size: 1.4rem;
    margin: 2rem 0 0.75rem 0;
    color: var(--text-primary);
}

p {
    margin: 1rem 0;
}

.code-block {
    position: relative;
    margin: 1.5rem 0;
}

.file-path {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    padding: 0.75rem 1rem;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.9rem;
    color: var(--accent);
}

.copy-button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s ease;
}

.copy-button:hover {
    background: var(--accent-hover);
}

.copy-button.copied {
    background: var(--success);
}

pre {
    margin: 0;
    padding: 1.5rem;
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 0 0 6px 6px;
    overflow-x: auto;
}

.file-path + pre {
    border-radius: 0 0 6px 6px;
}

code {
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
    color: var(--text-primary);
}

:not(pre) > code {
    background: var(--bg-tertiary);
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
}

.toggle-section {
    margin: 1.5rem 0;
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
}

.toggle-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    background: var(--bg-secondary);
    cursor: pointer;
    transition: background 0.2s ease;
    user-select: none;
}

.toggle-header:hover {
    background: var(--bg-tertiary);
}

.toggle-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.toggle-icon {
    font-size: 1.2rem;
    color: var(--text-secondary);
    transition: transform 0.3s ease;
}

.toggle-section.expanded .toggle-icon {
    transform: rotate(180deg);
}

.toggle-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.toggle-section.expanded .toggle-content {
    max-height: 5000px;
}

.toggle-inner {
    padding: 1.5rem;
}

ul, ol {
    margin: 1rem 0;
    padding-left: 2rem;
}

li {
    margin: 0.5rem 0;
}

a {
    color: var(--accent);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--accent-hover);
    text-decoration: underline;
}

strong {
    color: var(--text-primary);
    font-weight: 600;
}

@media (max-width: 1024px) {
    .toc {
        width: 250px;
    }

    .content {
        margin-left: 270px;
        padding: 1.5rem 2rem;
    }
}

@media (max-width: 768px) {
    .toc {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
    }

    .toc.mobile-open {
        transform: translateX(0);
    }

    .content {
        margin-left: 0;
        padding: 1rem;
    }

    .mobile-menu-button {
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 999;
        background: var(--accent);
        color: white;
        border: none;
        padding: 0.75rem;
        border-radius: 4px;
        cursor: pointer;
        display: block;
    }
}

.mobile-menu-button {
    display: none;
}
    </style>
</head>
<body>
    <button class="mobile-menu-button">☰ メニュー</button>

    <nav class="toc">
        <div class="toc-title">目次</div>
<ul class="toc-list">
  <li class="toc-item level-1"><a href="#カスタムドキュメントhtml化機能の実装" class="toc-link">カスタムドキュメントHTML化機能の実装</a></li>
  <li class="toc-item level-2"><a href="#概要" class="toc-link">概要</a></li>
  <li class="toc-item level-2"><a href="#変更したファイル" class="toc-link">変更したファイル</a></li>
  <li class="toc-item level-2"><a href="#実装内容" class="toc-link">実装内容</a></li>
  <li class="toc-item level-3"><a href="#フローティング目次機能" class="toc-link">フローティング目次機能</a></li>
  <li class="toc-item level-3"><a href="#ファイルパスコピー機能" class="toc-link">ファイルパスコピー機能</a></li>
  <li class="toc-item level-3"><a href="#トグル展開機能" class="toc-link">トグル展開機能</a></li>
  <li class="toc-item level-2"><a href="#技術的な背景解説" class="toc-link">技術的な背景・解説</a></li>
  <li class="toc-item level-3"><a href="#マークダウンパース処理" class="toc-link">マークダウンパース処理</a></li>
  <li class="toc-item level-3"><a href="#cssによるデザインシステム" class="toc-link">CSSによるデザインシステム</a></li>
  <li class="toc-item level-2"><a href="#技術的な判断設計決定" class="toc-link">技術的な判断・設計決定</a></li>
  <li class="toc-item level-2"><a href="#セキュリティ観点" class="toc-link">セキュリティ観点</a></li>
  <li class="toc-item level-3"><a href="#対策済みの項目" class="toc-link">対策済みの項目</a></li>
  <li class="toc-item level-3"><a href="#検討が必要な項目" class="toc-link">検討が必要な項目</a></li>
  <li class="toc-item level-3"><a href="#関連するセキュリティベストプラクティス" class="toc-link">関連するセキュリティベストプラクティス</a></li>
  <li class="toc-item level-2"><a href="#注意点制約" class="toc-link">注意点・制約</a></li>
  <li class="toc-item level-2"><a href="#関連知識参考資料" class="toc-link">関連知識・参考資料</a></li>
  <li class="toc-item level-3"><a href="#公式ドキュメント" class="toc-link">公式ドキュメント</a></li>
  <li class="toc-item level-3"><a href="#技術解説記事" class="toc-link">技術解説記事</a></li>
  <li class="toc-item level-3"><a href="#参考実装サンプルコード" class="toc-link">参考実装・サンプルコード</a></li>
  <li class="toc-item level-3"><a href="#関連する概念知識" class="toc-link">関連する概念・知識</a></li>
</ul>
    </nav>

    <main class="content">
        <h1 id="カスタムドキュメントhtml化機能の実装">カスタムドキュメントHTML化機能の実装</h1>
<h2 id="概要">概要</h2>
<p>マークダウンドキュメントを読みやすいHTMLに変換する機能を実装しました。目次、コピー機能、トグル展開などの機能を備えた、技術ドキュメント専用のビューアーを提供します。</p>
<h2 id="変更したファイル">変更したファイル</h2>
<ul>
  <li><code>plugins/custom-doc/skills/doc-to-html.md</code> - スキル定義とドキュメント</li>
  <li><code>plugins/custom-doc/scripts/markdown-to-html.py</code> - HTML生成スクリプト</li>
  <li><code>plugins/custom-doc/commands/create-doc.md</code> - コマンド定義の更新</li>
</ul>
<h2 id="実装内容">実装内容</h2>
<h3 id="フローティング目次機能">フローティング目次機能</h3>
<div class="code-block">
<p>  <div class="file-path"></p>
<p>    <span>plugins/custom-doc/scripts/markdown-to-html.py</span></p>
<p>    <button class="copy-button" data-path="plugins/custom-doc/scripts/markdown-to-html.py">コピー</button></p>
<p>  </div></p>
<p>  <pre><code class="language-javascript">// スクロール位置に応じて目次のアクティブ状態を更新</p>
<p>function updateActiveLink() {</p>
<p>    let current = &#39;&#39;;</p>
<p>    sections.forEach(section =&gt; {</p>
<p>        const sectionTop = section.offsetTop;</p>
<p>        if (pageYOffset &gt;= sectionTop - 100) {</p>
<p>            current = section.getAttribute(&#39;id&#39;);</p>
<p>        }</p>
<p>    });</p>
<p>}</p>
</code></pre>
</div>
<ul>
  <li>左側固定配置で常時表示</li>
  <li>スクロールに追随してアクティブセクションをハイライト</li>
  <li>クリックで該当セクションにスムーズスクロール</li>
</ul>
<h3 id="ファイルパスコピー機能">ファイルパスコピー機能</h3>
<p>コードブロックに表示されるファイルパスをワンクリックでコピーできる機能を実装。コピー成功時には視覚的フィードバックを提供します。</p>
<h3 id="トグル展開機能">トグル展開機能</h3>
<p>詳細情報を折りたたみ可能にすることで、ドキュメントの可読性を向上。概要は常時表示し、詳細は必要に応じて展開できます。</p>
<div class="toggle-section">
  <div class="toggle-header">
    <div class="toggle-title">技術的な背景と詳細な解説</div>
    <div class="toggle-icon">▼</div>
  </div>
  <div class="toggle-content">
    <div class="toggle-inner">

    </div>
  </div>
</div>
<h3 id="マークダウンパース処理">マークダウンパース処理</h3>
<p>正規表現を使用してマークダウン構文を解析し、HTMLに変換します。主な処理対象：</p>
<ul>
  <li>見出し（h1-h3）の抽出とID生成</li>
  <li>コードブロックの検出とシンタックスハイライト対応</li>
  <li>リスト、リンク、太字、斜体の変換</li>
  <li>インラインコードの処理</li>
</ul>
<h3 id="cssによるデザインシステム">CSSによるデザインシステム</h3>
<p>CSS変数を使用した一貫性のあるデザインシステムを構築：</p>
<div class="code-block">
<p>  <div class="file-path"></p>
<p>    <span>plugins/custom-doc/scripts/markdown-to-html.py</span></p>
<p>    <button class="copy-button" data-path="plugins/custom-doc/scripts/markdown-to-html.py">コピー</button></p>
<p>  </div></p>
<p>  <pre><code class="language-css">:root {</p>
<p>    --bg-primary: #1e1e1e;</p>
<p>    --bg-secondary: #252526;</p>
<p>    --text-primary: #d4d4d4;</p>
<p>    --accent: #569cd6;</p>
<p>}</p>
</code></pre>
</div>
<p>ダークモードベースで目に優しい配色を採用し、コードエディタ風の落ち着いた雰囲気を実現しています。</p>
<div class="toggle-section">
  <div class="toggle-header">
    <div class="toggle-title">設計判断の詳細</div>
    <div class="toggle-icon">▼</div>
  </div>
  <div class="toggle-content">
    <div class="toggle-inner">
<p>**なぜPythonスクリプトを選択したか**</p>
<ul>
  <li>マークダウンパース処理の柔軟性</li>
<ul>
  <li>正規表現による高度なパターンマッチング</li>
<ul>
  <li>ファイルI/O処理の簡潔さ</li>
<ul>
  <li>プロジェクト内の他のスクリプトとの一貫性</li>
</ul>
<p>**トレードオフの考慮**</p>
<ul>
  <li>シンプルさを優先し、外部ライブラリ（markdown2, mistune等）は使用しない</li>
<ul>
  <li>複雑なマークダウン構文（テーブル、脚注等）は現時点ではサポート外</li>
<ul>
  <li>必要に応じて将来的に機能拡張可能な設計</li>
</ul>
    </div>
  </div>
</div>
<div class="toggle-section">
  <div class="toggle-header">
    <div class="toggle-title">セキュリティの詳細情報</div>
    <div class="toggle-icon">▼</div>
  </div>
  <div class="toggle-content">
    <div class="toggle-inner">

    </div>
  </div>
</div>
<h3 id="対策済みの項目">対策済みの項目</h3>
<ul>
  <li>HTMLエスケープ処理による XSS 対策</li>
  <li>ユーザー入力の適切なサニタイゼーション</li>
  <li>ファイルパスの検証とパストラバーサル対策</li>
</ul>
<h3 id="検討が必要な項目">検討が必要な項目</h3>
<ul>
  <li>大容量マークダウンファイルの処理制限</li>
  <li>外部リンクのセキュリティ警告表示</li>
  <li>コンテンツセキュリティポリシー（CSP）の適用</li>
</ul>
<h3 id="関連するセキュリティベストプラクティス">関連するセキュリティベストプラクティス</h3>
<ul>
  <li>OWASP Top 10: Cross-Site Scripting (XSS) 対策</li>
  <li>入力検証とエスケープ処理のベストプラクティス</li>
  <li>セキュアなHTMLテンプレート設計</li>
</ul>
<div class="toggle-section">
  <div class="toggle-header">
    <div class="toggle-title">注意事項と制約</div>
    <div class="toggle-icon">▼</div>
  </div>
  <div class="toggle-content">
    <div class="toggle-inner">
<ul>
  <li>現時点では基本的なマークダウン構文のみサポート</li>
<ul>
  <li>テーブル、脚注、定義リストなどの高度な構文は未対応</li>
<ul>
  <li>ファイルサイズが大きいドキュメントではパフォーマンスに影響</li>
<ul>
  <li>ブラウザのJavaScript有効化が必須</li>
</ul>
    </div>
  </div>
</div>
<div class="toggle-section">
  <div class="toggle-header">
    <div class="toggle-title">参考資料とリンク</div>
    <div class="toggle-icon">▼</div>
  </div>
  <div class="toggle-content">
    <div class="toggle-inner">

    </div>
  </div>
</div>
<h3 id="公式ドキュメント">公式ドキュメント</h3>
<ul>
  <li><a href="https://docs.python.org/3/library/re.html">Python Regular Expressions</a> - 正規表現の公式ドキュメント</li>
  <li><a href="https://developer.mozilla.org/ja/docs/Web/HTML">MDN Web Docs - HTML</a> - HTML仕様とベストプラクティス</li>
  <li><a href="https://developer.mozilla.org/ja/docs/Web/CSS">MDN Web Docs - CSS</a> - CSS仕様とレイアウト技法</li>
</ul>
<h3 id="技術解説記事">技術解説記事</h3>
<ul>
  <li><a href="https://spec.commonmark.org/">CommonMark Specification</a> - マークダウンの標準仕様</li>
  <li><a href="https://css-tricks.com/snippets/css/complete-guide-grid/">CSS Grid Layout Guide</a> - CSSグリッドレイアウトの完全ガイド</li>
  <li><a href="https://www.w3.org/WAI/WCAG21/quickref/">Web Content Accessibility Guidelines</a> - アクセシビリティのガイドライン</li>
</ul>
<h3 id="参考実装サンプルコード">参考実装・サンプルコード</h3>
<ul>
  <li><a href="https://github.com/sindresorhus/github-markdown-css">GitHub Markdown CSS</a> - GitHubスタイルのマークダウンCSS</li>
  <li><a href="https://prismjs.com/">Prism.js</a> - シンタックスハイライトライブラリ（将来的な統合候補）</li>
</ul>
<h3 id="関連する概念知識">関連する概念・知識</h3>
<ul>
  <li><strong>パーサー設計</strong>: 字句解析と構文解析の基礎</li>
  <li><strong>DOM操作</strong>: JavaScriptによる動的なDOM更新</li>
  <li><strong>レスポンシブデザイン</strong>: メディアクエリとフレキシブルレイアウト</li>
  <li><strong>アクセシビリティ</strong>: セマンティックHTMLとARIA属性の活用</li>
</ul>
    </main>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    const sections = document.querySelectorAll('h1, h2, h3');
    const tocLinks = document.querySelectorAll('.toc-link');

    function updateActiveLink() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (pageYOffset >= sectionTop - 100) {
                current = section.getAttribute('id');
            }
        });

        tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + current) {
                link.classList.add('active');
            }
        });
    }

    window.addEventListener('scroll', updateActiveLink);
    updateActiveLink();

    tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    document.querySelectorAll('.copy-button').forEach(button => {
        button.addEventListener('click', function() {
            const filePath = this.getAttribute('data-path');
            navigator.clipboard.writeText(filePath).then(() => {
                const originalText = this.textContent;
                this.textContent = 'コピー完了!';
                this.classList.add('copied');

                setTimeout(() => {
                    this.textContent = originalText;
                    this.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('コピー失敗:', err);
            });
        });
    });

    document.querySelectorAll('.toggle-header').forEach(header => {
        header.addEventListener('click', function() {
            const section = this.parentElement;
            section.classList.toggle('expanded');
        });
    });

    const mobileMenuButton = document.querySelector('.mobile-menu-button');
    const toc = document.querySelector('.toc');

    if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', function() {
            toc.classList.toggle('mobile-open');
        });
    }
});
    </script>
</body>
</html>